<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Championnat CYYCCIT</title>

  <!-- Vue 3 CDN -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>

  <!-- Vuetify 3 CDN -->
  <link href="https://cdn.jsdelivr.net/npm/vuetify@3.10.7/dist/vuetify.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/vuetify@3.10.7/dist/vuetify.min.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/@mdi/font@7.4.47/scripts/verify.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/@mdi/font@7.4.47/css/materialdesignicons.min.css" rel="stylesheet">

  <!-- Roboto Font -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">


  <!-- Manifest -->
  <link href="/manifest.json" rel="manifest">

  <style>
    body {
      font-family: 'Roboto', sans-serif;
    }

    .bg-declasse {
      background-color: #d7d7d7;
      color: #656565;
    }

    .bg-manche_exclue {
      background-color: #ffd2d2;
      color: #8c0000;
    }

    .bg-comptabilise-true {
      background-color: #b0eb9d;
      color: #000000;
    }

    .bg-comptabilise-false {
      background-color: #faa197;
      color: #000000;
    }

    .podium {
      display: flex;
      align-items: flex-end;
      justify-content: center;
      color: white;
      font-weight: bold;
    }

    .podium_rank {
      color: #000;
      font-size: 1.5em;
    }

    .podium_rank_mobile {
      color: #000;
      font-size: 1.2em;
      font-weight: bold;
    }

    .podium_percent {
      color: #000;
      font-size: 1em;
    }

    .podium-wrapper {
      position: relative;
      width: 100%;
      max-width: 600px;
      /* Adjust as needed */
      margin: auto;
      margin-top: 25px;
    }

    .podium-image {
      width: 100%;
      height: auto;
      display: block;
    }

    /* Base style for all logos */
    .podium-logo {
      position: absolute;

      /* relative to podium width — scales responsively */
      transform: translate(-50%, -50%);
    }

    /* Positioning based on podium image proportions */
    .first {
      top: 12%;
      width: 30%;
      left: 50%;
    }

    .first_mobile {
      top: 2%;
      width: 30%;
      left: 50%;
    }

    .second {
      top: 40%;
      left: 22%;
      width: 22%;
    }

    .second_mobile {
      top: 30%;
      left: 22%;
      width: 22%;
    }

    .third {
      top: 52%;
      left: 78%;
      width: 18%;
    }

    .third_mobile {
      top: 42%;
      left: 78%;
      width: 18%;
    }

    .podium-name {
      position: absolute;
      transform: translate(-50%, -50%);
      font-size: 1.5em;
      color: #424242;
      text-align: center;
      line-height: 1em;
    }

    .podium-club-name {
      font-weight: bold;
    }

    .first-name {
      top: 42%;
      left: 50%;
    }

    .first-name_mobile {
      top: 38%;
      left: 50%;
    }

    .second-name {
      top: 58%;
      left: 22%;
    }

    .second-name_mobile {
      top: 54%;
      left: 22%;
    }

    .third-name {
      top: 67%;
      left: 78%;
    }

    .third-name_mobile {
      top: 62%;
      left: 78%;
    }

    .mobile {
      font-size: 0.8em;
    }

    .sheets_clubs {
      font-size: 1.2em;
    }

    .bateau_rank_1 {
      background-color: #efd55c;
    }

    .bateau_rank_2 {
      background-color: #bfbebe;
    }

    .bateau_rank_3 {
      background-color: #fba474;
    }

    .bateau_rank_null {
      background-color: #e1e9ff;
    }
  </style>
</head>

<body>
  <div id="app">
    <v-app>
      <v-main>
        <v-container class="py-8">
          <v-tabs v-if="isMobile" v-model="tab" grow color="white" bg-color="blue-lighten-4" stacked>
            <v-tab :class="tab === 0 ? 'bg-blue-darken-3' : ''">
              <v-icon icon="mdi-podium"></v-icon>
            </v-tab>
            <v-tab :class="tab === 1 ? 'bg-blue-darken-3' : ''">
              <v-icon icon="mdi-anchor"></v-icon>
            </v-tab>
            <v-tab :class="tab === 2 ? 'bg-blue-darken-3' : ''">
              <v-icon icon="mdi-sail-boat"></v-icon>
            </v-tab>
            <v-tab :class="tab === 3 ? 'bg-blue-darken-3' : ''">
              <v-icon icon="mdi-book-open-variant-outline"></v-icon>
            </v-tab>
          </v-tabs>
          <v-tabs v-else v-model="tab" grow color="white" bg-color="blue-lighten-4" stacked>
            <v-tab :class="tab === 0 ? 'bg-blue-darken-3' : ''">
              <v-icon icon="mdi-podium"></v-icon>
              Podiums
            </v-tab>
            <v-tab :class="tab === 1 ? 'bg-blue-darken-3' : ''">
              <v-icon icon="mdi-anchor"></v-icon>
              Classement Club
            </v-tab>
            <v-tab :class="tab === 2 ? 'bg-blue-darken-3' : ''">
              <v-icon icon="mdi-sail-boat"></v-icon>
              Classement Individuel
            </v-tab>
            <v-tab :class="tab === 3 ? 'bg-blue-darken-3' : ''">
              <v-icon icon="mdi-book-open-variant-outline"></v-icon>
              Règlement
            </v-tab>
          </v-tabs>

          <v-window v-model="tab" class="mt-4" :touch="false">




            <!--ONGLET PODIUM-->
            <v-window-item :value="0">
              <v-sheet class="text-h4 pa-4 ma-4 d-flex justify-center align-center" :elevation="1" color="blue-darken-3"
                :rounded="true">
                Club
              </v-sheet>
              <v-container>
                <div class="podium-wrapper" :class="{ 'mobile': isMobile }">
                  <!-- The podium image (background stand) -->
                  <img src="podium2.png" class="podium-image" />
                  <!-- Winner logos (absolutely positioned) -->
                  <img :src="getLogo(podium_clubs[0].Club,podium_clubs[0].Classement)"
                    :class="isMobile ? 'podium-logo first_mobile' : 'podium-logo first'" />
                  <div :class="isMobile ? 'podium-name first-name_mobile' : 'podium-name first-name'"><span
                      class="podium-club-name">{{podium_clubs[0].Club}}</span><br />{{podium_clubs[0].Total}}
                  </div>
                  <img :src="getLogo(podium_clubs[1].Club,podium_clubs[1].Classement)"
                    :class="isMobile ? 'podium-logo second_mobile' : 'podium-logo second'" />
                  <div :class="isMobile ? 'podium-name second-name_mobile' : 'podium-name second-name'"><span
                      class="podium-club-name">{{podium_clubs[1].Club}}</span><br />{{podium_clubs[1].Total}}
                  </div>
                  <img :src="getLogo(podium_clubs[2].Club,podium_clubs[2].Classement)"
                    :class="isMobile ? 'podium-logo third_mobile' : 'podium-logo third'" />
                  <div :class="isMobile ? 'podium-name third-name_mobile' : 'podium-name third-name'"><span
                      class="podium-club-name">{{podium_clubs[2].Club}}</span><br />{{podium_clubs[2].Total}}
                  </div>
                </div>
              </v-container>

              <v-sheet class="text-h4 pa-4 ma-4 d-flex justify-center align-center" :elevation="1" color="blue-darken-3"
                :rounded="true">
                Individuel
              </v-sheet>
              <v-container class="d-flex flex-wrap justify-center align-center">
                <v-container v-for="group in podium_bateaux" style="min-width: 300px; width:auto;"
                  class="justify-center align-center">
                  <v-sheet class="text-h6 pa-4 ma-4 d-flex justify-center align-center bg-blue-lighten-3"
                    :rounded="true">
                    {{group.groupe}}
                  </v-sheet>
                  <v-sheet v-for="bateau in group.bateaux" rounded :elevation="4"
                    :class="['pa-4', 'mb-4', 'sheets_clubs', `bateau_rank_${bateau.Classement || 'null' }`]">
                    <v-row>
                      <v-col cols="1"><b>{{bateau.Classement?? ''}}</b></v-col>
                      <v-col cols="8">{{bateau.Bateau?? ''}} {{bateau.Club?'('+bateau.Club+')':''}}</v-col>
                      <v-col cols="2">{{bateau.Total_points?? ''}}</v-col>
                    </v-row>
                  </v-sheet>
                </v-container>
              </v-container>


            </v-window-item>
            <!--ONGLET PODIUM-->




            <!--ONGLET CLASSEMENT CLUB-->
            <v-window-item :value="1">
              <v-data-table :items="results_club" :headers="headers_club">
                <template #headers="{ columns }">
                  <tr>
                    <th v-for="column in columns" :key="column.key" class="font-weight-bold">
                      {{ column.title }}
                    </th>
                  </tr>
                </template>
                <template v-slot:bottom>
                </template>
              </v-data-table>
            </v-window-item>
            <!--ONGLET CLASSEMENT CLUB-->





            <!--ONGLET CLASSEMENT BATEAUX-->
            <v-window-item :value="2">
              <v-container class="py-8">
                <v-tabs v-model="tab2" grow color="green-darken-4">
                  <v-tab v-for="groupe in groupes">{{groupe.Value}}</v-tab>
                </v-tabs>
                <v-window v-model="tab2" class="mt-4" :touch="false">
                  <v-window-item v-for="(groupe,index) in groupes" :value="index" :key="groupe.Value">
                    <v-data-table :headers="headers_bateaux"
                      :items="results_bateaux.filter(item=>item.Groupe==groupe.Value)" :item-class="getRowClass">
                      <template #headers="{ columns }">
                        <tr>
                          <th v-for="column in columns" :key="column.key" class="font-weight-bold">
                            {{ column.title }}
                          </th>
                        </tr>
                      </template>
                      <template #item="{ item }">
                        <tr :class="getRowClass(item)">
                          <td v-for="header in headers_bateaux" :key="header.key"
                            :class="getCellClass(item, header.key)">
                            {{ item[header.key] }}
                          </td>
                        </tr>
                      </template>
                      <template v-slot:bottom>
                      </template>
                    </v-data-table>
                  </v-window-item>
                </v-window>
              </v-container>
              <v-container>
                <v-chip width="400" variant="elevated" class="ma-2 bg-declasse">Bateau non
                  classé</v-chip>
                <v-chip width="400" variant="elevated" class="ma-2 bg-manche_exclue">Manche
                  exclue</v-chip>
              </v-container>
            </v-window-item>
            <!--ONGLET CLASSEMENT BATEAUX-->





            <!--ONGLET REGLEMENT-->
            <v-window-item :value="3">
              <v-container class="py-8">



                <v-card elevation="3" prepend-icon="mdi-flag-checkered" rounded="xl" color="deep-purple-lighten-5">
                  <template v-slot:title>
                    <span class="font-weight-black">Structure Générale</span>
                  </template>

                  <v-card-text>
                    Le championnat CYYCCIT comporte :<br />
                    - Un classement individuel (par bateau, dans sa catégorie)<br />
                    - Un classement par club<br />
                    Il se déroule sur plusieurs manches (courses).
                    Chaque bateau obtient un score à chaque manche, en fonction de sa place ou d’une
                    pénalité.
                  </v-card-text>
                </v-card>
                <br /><br />



                <v-card elevation="3" prepend-icon="mdi-sail-boat" rounded="xl" color="deep-purple-lighten-5">
                  <template v-slot:title>
                    <span class="font-weight-black">Classement Individuel</span>
                  </template>

                  <v-card-text>
                    <b>Score d’un bateau sur une manche</b><br />
                    Le score dépend du résultat :<br /><br />
                    <v-data-table :items="formattedClassement"
                      :headers="[{ title: 'Classement du bateau', key: 'statut' }, { title: 'Score obtenu', key: 'description' }]">
                      <template #headers="{ columns }">
                        <tr>
                          <th v-for="col in columns" :key="col.key" class="font-weight-bold">
                            {{ col.title }}</th>
                        </tr>
                      </template>
                      <template v-slot:bottom>
                      </template>
                    </v-data-table>
                    <v-alert :value="true" type="info" class="mt-4" variant="outlined">
                      <b>Remarque :</b><br />
                      Un bateau est considéré comme participant à une manche <b>s'il est classé
                        <span v-for="(item, i) in def_classement.filter(item=>item.Comptabilise_participants=='TRUE')"
                          :key="i">
                          ou {{ item.Value }}
                        </span></b>.
                    </v-alert>
                    <br /><br />
                    <b>Exemple de calcul</b><br />
                    Supposons :
                    <br />
                    3 groupes (catégories) : HN1 (5 bateaux), HN2 (4 bateaux), HN3 (3 bateaux)
                    <br />
                    → Le plus grand groupe a 5 bateaux.
                    <br /><br />
                    En tout, 12 bateaux participent au championnat.<br />
                    <v-data-table :items="formattedClassement_exemple2"
                      :headers="[{ title: 'Classement du bateau', key: 'statut' }, { title: 'Score obtenu', key: 'description' }]">
                      <template #headers="{ columns }">
                        <tr>
                          <th v-for="col in columns" :key="col.key" class="font-weight-bold">
                            {{ col.title }}</th>
                        </tr>
                      </template>
                      <template v-slot:bottom>
                      </template>
                    </v-data-table>
                    <br /><br />
                    <b>Score total du bateau</b><br />
                    Le score total = somme des scores sur toutes les manches – sa plus mauvaise
                    manche (score le plus
                    élevé).<br /><br />
                    Exemple :<br />
                    Un bateau fait les manches suivantes :<br />
                    3, 5, 2, 6, 1 → la plus mauvaise est 6, donc :<br />
                    Total = 3 + 5 + 2 + 6 + 1 – 6 = 11 points
                    <br /><br />

                    <b>Classement final</b><br />
                    Les bateaux sont classés par catégorie (groupe), selon leur score total (le plus
                    petit est
                    meilleur).<br /><br />

                    En cas d’égalité :<br />
                    1. On compare le nombre de 1res places → celui qui en a le plus est mieux
                    classé.<br />
                    2. Si encore égalité, on compare les 2es places, puis les 3es, etc.
                  </v-card-text>
                </v-card>

                <br /><br />
                <v-card elevation="3" prepend-icon="mdi-anchor" rounded="xl" color="deep-purple-lighten-5">
                  <template v-slot:title>
                    <span class="font-weight-black">Classement Club</span>
                  </template>

                  <v-card-text>

                    <v-alert :value="true" type="info" variant="outlined">
                      Ce classement évalue la participation des bateaux de chaque club sur
                      l’ensemble des manches.
                      Plus un club mobilise ses bateaux, plus son score est élevé.<br />
                      Cela valorise la régularité et l’engagement du club tout au long de la
                      saison, même sans
                      podiums.
                    </v-alert>

                    <br />
                    <b>Calcul du pourcentage de participation :</b><br />
                    À chaque manche et pour chaque club, sont comptabilisés le nombre de bateaux
                    participants, rapportés
                    au nombre total de
                    bateaux du club (càd qui ont concuru au moins une manche pendant tout le
                    championnat)<br /><br />

                    <v-alert :value="true" type="warning" variant='outlined'>
                      <h3>Règles d'éligibilité</h3><br />
                      Un club est classé s'il possède au moins <b>{{def_parametres[2].Valeur}}
                        bateaux</b> participant.
                      <br /><br />

                      Un bateau doit avoir participé à au moins <b>{{def_parametres[0].Valeur}}
                        manches</b> pour être
                      pris en compte dans le
                      classement de son club (seulement si le championnat comporte au moins
                      <b>{{def_parametres[1].Valeur}} manches</b>).
                      <br />Un bateau est considéré comme participant à une manche <b>s'il est
                        classé
                        <span v-for="(item, i) in def_classement.filter(item=>item.Comptabilise_participants=='TRUE')"
                          :key="i">
                          ou {{ item.Value }}
                        </span></b>.
                      <br /><br />
                      Ne sont comptabilisés que les bateaux faisant partie des groupes
                      <b><span v-for="(item, i) in groupes.filter(item=>item.Comptabilise=='TRUE')" :key="i">
                          {{ item.Value }}<span v-if="i < def_classement.length - 1">, </span>
                        </span></b>.
                    </v-alert>
                    <br /><br />
                    Cela donne un pourcentage de participation par manche et par club.
                    Le total obtenu par le club est la moyenne de ces pourcentages de participation.
                    <br /><br />
                    Le club ayant le pourcentage le plus élevé est vainqueur de ce classement.

                    <br /><br /><b>En cas d'égalité:</b><br />
                    Pour départager deux clubs qui auraient le même pourcentage de participation.
                    Sont comparés alors
                    les classements individuels.
                    Est considéré comme gagnant, le club qui cumule le plus de premières places. En
                    cas d'égalité, sont
                    comparées les deuxièmes places, etc..

                    <br /><br />
                    <b>Exemple:</b><br />
                    <v-data-table :items="exemple1">
                      <template v-slot:bottom>
                      </template>
                    </v-data-table>
                    <br /><br />
                    Le résultat par club est donc:<br /><br />
                    <v-data-table :items="exemple2">
                      <template v-slot:bottom>
                      </template>
                    </v-data-table>
                    <br /><br />
                    Pour départager Rouge et Vert, on compare les premières places (0 pour Rouge, 0
                    pour Vert), puis les
                    deuxièmes places (0 pour Rouge, 1 pour Vert). C'est donc Vert devant
                    Rouge.<br /> Bleu est dernier
                    avec un
                    pourcentage de participation inférieur à Rouge et Vert.
                  </v-card-text>
                </v-card>
                </v-card>


              </v-container>
            </v-window-item>
            <!--ONGLET REGLEMENT-->





          </v-window>
          <v-snackbar v-if="canInstall" v-model="snackbar" timeout="10000">
            Installer l'application
            <template v-slot:actions>
              <v-btn color="light-green-accent-2" variant="text" @click="installApp">
                Oui
              </v-btn>
              <v-btn color="pink-accent-2" variant="text" @click="snackbar = false">
                Non
              </v-btn>
            </template>
          </v-snackbar>
        </v-container>
      </v-main>
    </v-app>
  </div>

  <script>
    const { createApp, ref, onMounted, computed } = Vue;
    const { createVuetify } = Vuetify;
    const vuetify = createVuetify();

    const app = createApp({
      setup() {
        const tab = ref(0);
        const tab2 = ref(0);
        const results_bateaux = ref([]);
        const results_club = ref([]);
        const groupes = ref([]);
        const headers_bateaux = ref([]);
        const headers_club = ref([]);
        const podium_heights_club = [80, 100, 120, 130, 110, 90, 70];
        const podium_width_club = [9, 7, 5, 4, 4, 4, 4];
        const podium_colors_club = ['67b3dd', '67b3dd', 'b7b5b5', 'd0b547', 'e8976e', '67b3dd', '67b3dd'];
        const podium_colors_club_mobile = ['d0b547', 'b7b5b5', 'e8976e', '67b3dd', '67b3dd', '67b3dd', '67b3dd'];
        const podium_heights_bateau = [120, 130, 110];
        const podium_width_bateau = [8, 6, 4];
        const podium_colors_bateau = ['b7b5b5', 'd0b547', 'e8976e'];
        const podium_colors_bateau_mobile = ['d0b547', 'b7b5b5', 'e8976e'];
        const podium_ranking_bateau = [1, 2, 3];
        const podium_ranking_club = [1, 2, 3, 4, 5, 6, 7];
        const podium_clubs = ref([]);
        const podium_bateaux = ref([]);
        let rankedBateaux = [];
        const { useDisplay } = Vuetify;
        const display = useDisplay();

        const isMobile = computed(() => !display.smAndUp.value);

        const canInstall = ref(false);
        const deferredPrompt = ref(null);
        const snackbar = ref(true);
        const def_classement = ref([]);
        const def_parametres = ref([]);

        const formattedClassement = computed(() => {
          let tmp = [
            { statut: "Classé 1er de sa catégorie", description: "1 point" },
            { statut: "Classé 2ème de sa catégorie", description: "2 points" },
            { statut: "Classé 3ème de sa catégorie", description: "3 points" },
            { statut: "...", description: "..." }
          ];

          def_classement.value.forEach(item => {
            let description;
            switch (item.Reference) {
              case 'Plus grand groupe':
                description = `(nombre de bateaux du plus grand groupe) + ${item.Penalite}`;
                break;
              case 'Groupe du bateau':
                description = `(nombre de bateaux du groupe) + ${item.Penalite}`;
                break;
              case 'Groupe du bateau':
                description = `(nombre total de bateaux participant à la manche) + ${item.Penalite}`;
                break;
              default:
                description = `(nombre total de bateaux participant à la manche) + ${item.Penalite}`;
                break;
            };
            tmp.push({ statut: item.Value, description: description });
          })

          return tmp;
        });

        const formattedClassement_exemple2 = computed(() => {
          let tmp = [
            { statut: "2e de sa catégorie", description: "2 points" },
          ];

          def_classement.value.forEach(item => {
            let description;
            switch (item.Reference) {
              case 'Plus grand groupe':
                description = `5 (taille du plus grand groupe) + ${item.Penalite} = ${5 + Number(item.Penalite)}`;
                break;
              case 'Groupe du bateau':
                description = `Pour HN3, 3 (taille du groupe) + ${item.Penalite} = ${3 + Number(item.Penalite)}`;
                break;
              case 'Groupe du bateau':
                description = `12(total bateaux) + ${item.Penalite} = ${12 + Number(item.Penalite)}`;
                break;
              default:
                description = `12(total bateaux) + ${item.Penalite} = ${12 + Number(item.Penalite)}`;
                break;
            };
            tmp.push({ statut: item.Value, description: description });
          })

          return tmp;
        });


        const exemple1 = [
          {
            Bateau: 'Alpha',
            Club: 'Bleu',
            Manche_1: '1',
            Manche_2: 'DNC',
            Manche_3: '2'
          }, {
            Bateau: 'Beta',
            Club: 'Bleu',
            Manche_1: '2',
            Manche_2: '1',
            Manche_3: '3'
          }, {
            Bateau: 'Gamma',
            Club: 'Bleu',
            Manche_1: 'DNC',
            Manche_2: 'DNC',
            Manche_3: '1'
          }, {
            Bateau: 'Delta',
            Club: 'Rouge',
            Manche_1: '3',
            Manche_2: 'DNC',
            Manche_3: '6'
          }, {
            Bateau: 'Epsilon',
            Club: 'Rouge',
            Manche_1: '4',
            Manche_2: '4',
            Manche_3: '5'
          }, {
            Bateau: 'Zeta',
            Club: 'Vert',
            Manche_1: '5',
            Manche_2: '3',
            Manche_3: 'DNC'
          }, {
            Bateau: 'Eta',
            Club: 'Vert',
            Manche_1: '6',
            Manche_2: '2',
            Manche_3: '4'
          }
        ];

        const exemple2 = [
          {
            Club: 'Bleu',
            Bateaux_total: '3',
            Manche_1: '2/3 => 66%',
            Manche_2: '1/3 => 33%',
            Manche_3: '3/3 => 100%',
            Total: '6/9 => 66%',
            Classement: '3'
          }, {
            Club: 'Rouge',
            Bateaux_total: '2',
            Manche_1: '2/2 => 100%',
            Manche_2: '1/2 => 50%',
            Manche_3: '2/2 => 100%',
            Total: '5/6 => 83%',
            Classement: '2'
          }, {
            Club: 'Vert',
            Bateaux_total: '2',
            Manche_1: '2/2 => 100%',
            Manche_2: '2/2 => 100%',
            Manche_3: '1/2 => 50%',
            Total: '5/6 => 83%',
            Classement: '1'
          }
        ];

        const exemple3 = [
          {
            Bateau: 'Alpha',
            Club: 'Bleu',
            Groupe: "HN1",
            'Classement sur la manche': '1',
            score: '1'
          }, {
            Bateau: 'Zeta',
            Club: 'Hors championnat',
            Groupe: "HN1",
            'Classement sur la manche': '2',
            score: 'Hors championnat'
          }, {
            Bateau: 'Beta',
            Club: 'Bleu',
            Groupe: "HN1",
            'Classement sur la manche': '3',
            score: '3'
          }, {
            Bateau: 'Delta',
            Club: 'Rouge',
            Groupe: "HN1",
            'Classement sur la manche': 'DNF',
            score: '1+4=5'
          }, {
            Bateau: 'Gamma',
            Club: 'Bleu',
            Groupe: "HN2",
            'Classement sur la manche': '1',
            score: '1'
          }, {
            Bateau: 'Epsilon',
            Club: 'Rouge',
            Groupe: "HN2",
            'Classement sur la manche': 'DNC',
            score: '5+6=11'
          }, {
            Bateau: 'Iota',
            Club: 'Vert',
            Groupe: "HN3",
            'Classement sur la manche': '1',
            score: '1'
          }, {
            Bateau: 'Eta',
            Club: 'Vert',
            Groupe: "HN3",
            'Classement sur la manche': 'DNS',
            score: '3+6=9'
          }
        ];

        onMounted(() => {
          window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt.value = e;
            canInstall.value = true;
          });

          Promise.all([
            fetch('https://sheets.googleapis.com/v4/spreadsheets/1LL27xNtglUsxVkloFlbmKoTiWVDv-dw_78JvwGBrdV0/values/Web-Clubs?key=AIzaSyCQjRhn4HdRWrzbgac9Xb-9zYIXrxjYixI').then(res => res.json()),
            fetch('https://sheets.googleapis.com/v4/spreadsheets/1LL27xNtglUsxVkloFlbmKoTiWVDv-dw_78JvwGBrdV0/values/Manches?key=AIzaSyCQjRhn4HdRWrzbgac9Xb-9zYIXrxjYixI').then(res => res.json()),
            fetch('https://sheets.googleapis.com/v4/spreadsheets/1LL27xNtglUsxVkloFlbmKoTiWVDv-dw_78JvwGBrdV0/values/Web-Bateaux?key=AIzaSyCQjRhn4HdRWrzbgac9Xb-9zYIXrxjYixI').then(res => res.json()),
            fetch('https://sheets.googleapis.com/v4/spreadsheets/1LL27xNtglUsxVkloFlbmKoTiWVDv-dw_78JvwGBrdV0/values/ListeGroupes?key=AIzaSyCQjRhn4HdRWrzbgac9Xb-9zYIXrxjYixI').then(res => res.json()),
            fetch('https://sheets.googleapis.com/v4/spreadsheets/1LL27xNtglUsxVkloFlbmKoTiWVDv-dw_78JvwGBrdV0/values/ListeClassements?key=AIzaSyCQjRhn4HdRWrzbgac9Xb-9zYIXrxjYixI').then(res => res.json()),
            fetch('https://sheets.googleapis.com/v4/spreadsheets/1LL27xNtglUsxVkloFlbmKoTiWVDv-dw_78JvwGBrdV0/values/Parametres?key=AIzaSyCQjRhn4HdRWrzbgac9Xb-9zYIXrxjYixI').then(res => res.json())
          ])
            .then(([data1, data2, data3, data4, data5, data6]) => {
              const classement_club_headers = data1.values[0];
              const classement_club = data1.values.slice(1).map(item => Object.fromEntries(classement_club_headers.map((key, i) => [key, item[i]])));

              const classement_bateaux_headers = data3.values[0];
              const classement_bateaux = data3.values.slice(1).map(item => Object.fromEntries(classement_bateaux_headers.map((key, i) => [key, item[i]])));

              const manches_headers = data2.values[0];
              const manches = data2.values.slice(1).map(item => Object.fromEntries(manches_headers.map((key, i) => [key, item[i]])));
              const mancheCourues = manches.filter(manche => manche.Statut == "Courue");

              const groupes_headers = data4.values[0];
              const localGroupes = data4.values.slice(1).map(item => Object.fromEntries(groupes_headers.map((key, i) => [key, item[i]])));
              groupes.value = localGroupes;

              const def_classement_headers = data5.values[0];
              def_classement.value = data5.values.slice(-4).map(item => Object.fromEntries(def_classement_headers.map((key, i) => [key, item[i]])));
              console.log(def_classement.value);
              const parametres_headers = data6.values[0];
              def_parametres.value = data6.values.slice(1).map(item => Object.fromEntries(parametres_headers.map((key, i) => [key, item[i]])));
              console.log(def_parametres.value[0].Valeur);

              headers_bateaux.value = [
                { title: 'Classement', key: 'Classement' },
                { title: 'Bateau', key: 'Bateau' },
                { title: 'Skipper', key: 'Skipper' },
                { title: 'Club', key: 'Club' }
              ]

              headers_club.value = [
                { title: 'Classement', key: 'Classement' },
                { title: 'Club', key: 'Club' }
              ]

              for (let i = 0; i < mancheCourues.length; i++) {
                headers_bateaux.value.push({ title: "Manche " + mancheCourues[i].ID + "-" + mancheCourues[i].Club, key: "Manche_" + mancheCourues[i].ID });
                headers_club.value.push({ title: "Manche " + mancheCourues[i].ID + "-" + mancheCourues[i].Club, key: "Manche_" + mancheCourues[i].ID });
              }

              headers_bateaux.value.push({ title: 'Total', key: 'Total_points' });

              headers_club.value.push({ title: 'Total', key: 'Total' });



              // Club ranking
              let items_club = [];

              for (const club of classement_club) {
                let item = {
                  "Club": club["Club"]
                };

                for (let i = 0; i < mancheCourues.length; i++) {
                  item["Manche_" + mancheCourues[i].ID] = club["Manche_" + mancheCourues[i].ID];
                }

                item.Classement = club["Classement"];
                item.Total = club["Total_participation"];

                items_club.push(item);
              }

              items_club.sort((a, b) => Number(a.Classement) - Number(b.Classement));
              results_club.value = items_club;
              podium_clubs.value = rankClubsPodium(items_club);



              // Bateaux ranking

              classement_bateaux.sort((a, b) => {
                if (a.Total_points != b.Total_points) {
                  return Number(a.Total_points) - Number(b.Total_points)
                } else {
                  return Number(b.Ponderation) - Number(a.Ponderation)
                }
              }
              );

              const groupCounters = {};

              rankedBateaux = classement_bateaux.map(bateau => {
                const groupe = bateau.Groupe;

                if (!groupCounters[groupe]) {
                  groupCounters[groupe] = 1;
                } else {
                  groupCounters[groupe]++;
                }

                return {
                  ...bateau,
                  Classement: bateau.Classe == "TRUE" ? groupCounters[groupe] : ''
                };
              });

              rankedBateaux.sort((a, b) => {
                if (a.Classement > b.Classement) {
                  return 1
                } else {
                  return -1
                }
              });

              localGroupes.forEach(function (groupe) {
                let filtered = rankedBateaux.filter(item => item.Groupe == groupe.Value);
                let podiumRankedBateaux = rankBateauxPodium(filtered);
                podium_bateaux.value.push({
                  groupe: groupe.Value,
                  bateaux: podiumRankedBateaux
                })
              })
              results_bateaux.value = rankedBateaux;

            })
            .catch(() => {
              console.error('Error fetching data');
            });
        });

        function getRowClass(item) {
          return item.Classe == "FALSE" ? 'bg-declasse' : '';
        }

        function getRowClassExample(bool) {
          return bool == true ? 'bg-comptabilise-true' : 'bg-comptabilise-false';
        }

        function getCellClass(item, index) {
          if ((index == 'Manche_' + item.Manche_exclue) && (item.Classe == "TRUE")) {
            return 'bg-manche_exclue';
          }
        }

        function rankClubsPodium(clubs) {
          let rankedClubs = [];
          podium_ranking_club.forEach(function (rank) {
            let club = clubs.find(c => c.Classement == rank);
            rankedClubs.push(club);
          })
          return rankedClubs;
        }

        function rankBateauxPodium(bateaux) {
          let rankedBateaux = [];
          podium_ranking_bateau.forEach(function (rank) {
            let bateau = bateaux.find(c => c.Classement == rank) || {};
            rankedBateaux.push(bateau);
          })
          return rankedBateaux;
        }

        function getLogo(club, classement) {
          let suffix;
          switch (classement) {
            case "1":
              suffix = "or";
              break;
            case "2":
              suffix = "argent";
              break;
            case "3":
              suffix = "bronze";
              break;
            default:
              suffix = "autre";
              break;
          }

          let filePath = "logos/" + club + "_" + suffix + ".png";
          return filePath;
        }

        function computeRankingPodiumTitle(Classement) {
          let suffix;
          switch (Classement) {
            case "1":
              suffix = "er";
              break;
            default:
              suffix = "ème";
              break;
          }
          return Classement + suffix;
        }

        function getBateauPodium(group, rank) {
          let filtered = rankedBateaux.filter(item => item.Groupe == group);
          let selectedBateau = filtered[rank - 1];
          return selectedBateau.Classe == "TRUE" ? selectedBateau : null;
        }

        function installApp() {
          if (deferredPrompt.value) {
            deferredPrompt.value.prompt();
            deferredPrompt.value.userChoice.then(() => {
              deferredPrompt.value = null;
              canInstall.value = false;
            });
          }
        }

        return { canInstall, exemple1, formattedClassement, formattedClassement_exemple2, exemple2, exemple3, def_classement, def_parametres, snackbar, installApp, tab, tab2, results_bateaux, results_club, groupes, headers_bateaux, headers_club, getRowClass, getRowClassExample, getCellClass, podium_heights_club, podium_heights_bateau, podium_colors_bateau_mobile, podium_width_bateau, podium_colors_club_mobile, podium_colors_bateau, podium_colors_club, podium_clubs, podium_bateaux, getLogo, computeRankingPodiumTitle, getBateauPodium, podium_ranking_bateau, podium_ranking_club, display, isMobile, podium_width_club };
      }
    });
    app.use(vuetify);
    app.mount('#app');
  </script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/service-worker.js')
        .then(function () { console.log('Service Worker registered') })
        .catch(err => console.error('Service Worker registration failed:', err));
    }
  </script>
</body>

</html>
